<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>TEST GAMBAR - TK</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(180deg,#fff6e5,#fde2e4);
}

#menu, #toolbar{
  display:flex;
  justify-content:center;
  gap:12px;
  padding:10px;
  background:#fff;
}

#menu button{
  font-size:18px;
  padding:10px 16px;
  border:none;
  border-radius:14px;
  background:#ffd966;
}

#menu button.disabled{
  opacity:0.4;
}

#toolbar{
  display:none;
}

.color{
  width:28px;
  height:28px;
  border-radius:50%;
  border:2px solid #ccc;
}

button{
  font-size:18px;
  padding:8px 12px;
  border:none;
  border-radius:12px;
  background:#ffd966;
}

button.disabled{
  opacity:0.4;
}

canvas{
  display:none;
  margin:10px auto;
  background:#fffaf3;
  border-radius:16px;
  border:2px dashed #f5cba7;
  touch-action:none;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu">
  <button onclick="startTK()">üé® Warnai</button>
  <button class="disabled">‚úèÔ∏è Gambar</button>
</div>

<!-- CANVAS -->
<canvas id="canvas" width="360" height="420"></canvas>

<!-- TOOLBAR -->
<div id="toolbar">
  <div class="color" style="background:red" onclick="setColor('red')"></div>
  <div class="color" style="background:blue" onclick="setColor('blue')"></div>
  <div class="color" style="background:yellow" onclick="setColor('yellow')"></div>

  <button onclick="setTool('erase')">üßΩ</button>
  <button id="playBtn" class="disabled" onclick="onPlay()">‚ñ∂Ô∏è</button>
</div>

<script>
/* ===== STATE ===== */
let mode = null;
let activeTool = 'marker';
let selectedColor = 'red';
let coloredAreaCount = 0;
let isPlaying = false;

/* ===== VOICE ===== */
function speak(text){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'id-ID';
  u.rate = 0.9;
  speechSynthesis.speak(u);
}

/* ===== CANVAS ===== */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

/* ===== AREA ===== */
const areas = {
  head: { x:180, y:130, r:60, color:null },
  body: { x:180, y:280, r:90, color:null }
};

/* ===== START TK ===== */
function startTK(){
  mode = 'tk';
  document.getElementById('menu').style.display = 'none';
  canvas.style.display = 'block';
  document.getElementById('toolbar').style.display = 'flex';

  drawCat();
  speak("Pilih warna, lalu warnai gambarnya.");
}

/* ===== DRAW ===== */
function drawCat(offsetY = 0){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.lineWidth = 4;
  ctx.strokeStyle = '#000';

  // head
  ctx.fillStyle = areas.head.color || '#eee';
  ctx.beginPath();
  ctx.arc(180,130+offsetY,60,0,Math.PI*2);
  ctx.fill(); ctx.stroke();

  // body
  ctx.fillStyle = areas.body.color || '#eee';
  ctx.beginPath();
  ctx.ellipse(180,280+offsetY,80,100,0,0,Math.PI*2);
  ctx.fill(); ctx.stroke();
}

/* ===== INPUT ===== */
canvas.onclick = (e)=>{
  if(isPlaying || mode !== 'tk') return;

  const x = e.offsetX;
  const y = e.offsetY;

  if(activeTool === 'marker'){
    for(let key in areas){
      const a = areas[key];
      const d = Math.hypot(x-a.x,y-a.y);
      if(d < a.r){
        if(!a.color){
          coloredAreaCount++;
          checkPlayEnable();
        }
        a.color = selectedColor;
        drawCat();
        break;
      }
    }
  }

  if(activeTool === 'erase'){
    for(let key in areas){
      const a = areas[key];
      const d = Math.hypot(x-a.x,y-a.y);
      if(d < a.r){
        if(a.color){
          a.color = null;
          coloredAreaCount--;
          checkPlayEnable();
          drawCat();
        }
        break;
      }
    }
  }
};

/* ===== TOOL ===== */
function setColor(c){
  activeTool = 'marker';
  selectedColor = c;
}

function setTool(tool){
  activeTool = tool;
  if(tool === 'erase'){
    speak("Sentuh warna yang mau dihapus.");
  }
}

/* ===== PLAY ===== */
function checkPlayEnable(){
  const btn = document.getElementById('playBtn');
  if(coloredAreaCount >= 1){
    btn.classList.remove('disabled');
  }else{
    btn.classList.add('disabled');
  }
}

function onPlay(){
  if(coloredAreaCount < 1){
    speak("Warnai dulu gambarnya ya.");
    return;
  }

  isPlaying = true;
  speak("Lihat, gambarnya hidup!");

  animate();

  setTimeout(()=>{
    isPlaying = false;
    drawCat();
  },4000);
}

/* ===== ANIMATION ===== */
function animate(){
  let t = 0;
  const id = setInterval(()=>{
    t++;
    const offset = Math.sin(t)*10;
    drawCat(offset);
    if(t > 20){
      clearInterval(id);
    }
  },100);
}
</script>

</body>
</html>
