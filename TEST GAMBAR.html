<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sketch World ‚Äì Final + Colors</title>
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(180deg,#fff6e5,#fde2e4);
}
#menu,#worldbar,#toolbar{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  padding:10px;
  background:#fff;
  flex-wrap:wrap;
}
#menu{
  flex-direction:column;
  height:100vh;
  text-align:center;
}
#worldbar,#toolbar,canvas{display:none}
button{
  font-size:16px;
  padding:8px 12px;
  border-radius:14px;
  border:none;
  background:#ffd966;
  cursor:pointer;
}
.color-btn{
  width:28px;
  height:28px;
  border-radius:50%;
  border:2px solid #ddd;
  padding:0;
}
.color-btn.active{
  border:3px solid #333;
}
canvas{
  display:block;
  margin:10px auto;
  background:#fffaf3;
  border-radius:16px;
  border:2px dashed #f5cba7;
  touch-action:none;
}
</style>
</head>
<body>

<!-- MENU -->
<div id="menu">
  <h2>üëã Selamat Datang</h2>
  <p>Kita akan menggambar dan mewarnai bersama</p>
  <button onclick="startGame()">Aku siap!</button>
</div>

<!-- WORLD -->
<div id="worldbar">
  <button onclick="switchWorld('kucing')">üê±</button>
  <button onclick="switchWorld('mobil')">üöó</button>
  <button onclick="switchWorld('gunung')">üå±</button>
</div>

<canvas id="canvas" width="800" height="450"></canvas>

<!-- TOOLS -->
<div id="toolbar">
  <!-- COLORS -->
  <button class="color-btn active" style="background:#000" onclick="setColor('#000',this)"></button>
  <button class="color-btn" style="background:#e53935" onclick="setColor('#e53935',this)"></button>
  <button class="color-btn" style="background:#fb8c00" onclick="setColor('#fb8c00',this)"></button>
  <button class="color-btn" style="background:#fdd835" onclick="setColor('#fdd835',this)"></button>
  <button class="color-btn" style="background:#43a047" onclick="setColor('#43a047',this)"></button>
  <button class="color-btn" style="background:#1e88e5" onclick="setColor('#1e88e5',this)"></button>
  <button class="color-btn" style="background:#8e24aa" onclick="setColor('#8e24aa',this)"></button>
  <button class="color-btn" style="background:#6d4c41" onclick="setColor('#6d4c41',this)"></button>
  <button class="color-btn" style="background:#f48fb1" onclick="setColor('#f48fb1',this)"></button>
  <button class="color-btn" style="background:#26c6da" onclick="setColor('#26c6da',this)"></button>
  <button class="color-btn" style="background:#9e9e9e" onclick="setColor('#9e9e9e',this)"></button>
  <button class="color-btn" style="background:#ffffff" onclick="setColor('#ffffff',this)"></button>

  <button onclick="tool='erase'">üßΩ</button>
  <button onclick="play()">‚ñ∂Ô∏è</button>
</div>

<script>
/* ================= VOICE ================= */
let voiceQueue = Promise.resolve();
function speak(text){
  voiceQueue = voiceQueue.then(()=>new Promise(resolve=>{
    const u = new SpeechSynthesisUtterance(text);
    u.lang='id-ID'; u.rate=0.9; u.pitch=1.1;
    u.onend=resolve;
    speechSynthesis.speak(u);
  }));
}
function clearVoice(){
  speechSynthesis.cancel();
  voiceQueue = Promise.resolve();
}

/* ================= AUDIO ================= */
let audioCtx;
function audio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  }
}
function meong(){
  audio();
  let t=audioCtx.currentTime;
  for(let i=0;i<3;i++){
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='square';
    o.frequency.setValueAtTime(650,t+i*0.4);
    o.frequency.exponentialRampToValueAtTime(300,t+i*0.4+0.25);
    g.gain.setValueAtTime(0.001,t+i*0.4);
    g.gain.exponentialRampToValueAtTime(0.6,t+i*0.4+0.05);
    g.gain.exponentialRampToValueAtTime(0.001,t+i*0.4+0.3);
    o.connect(g).connect(audioCtx.destination);
    o.start(t+i*0.4); o.stop(t+i*0.4+0.35);
  }
}
function brum(){
  audio();
  let t=audioCtx.currentTime;
  for(let i=0;i<4;i++){
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='sawtooth';
    o.frequency.setValueAtTime(140,t+i*0.3);
    o.frequency.linearRampToValueAtTime(80,t+i*0.3+0.25);
    g.gain.setValueAtTime(0.001,t+i*0.3);
    g.gain.linearRampToValueAtTime(0.5,t+i*0.3+0.05);
    g.gain.linearRampToValueAtTime(0.001,t+i*0.3+0.28);
    o.connect(g).connect(audioCtx.destination);
    o.start(t+i*0.3); o.stop(t+i*0.3+0.3);
  }
}
function angin(){
  audio();
  const buffer=audioCtx.createBuffer(1,audioCtx.sampleRate*2,audioCtx.sampleRate);
  const data=buffer.getChannelData(0);
  for(let i=0;i<data.length;i++) data[i]=(Math.random()*2-1)*0.6;
  const src=audioCtx.createBufferSource(), g=audioCtx.createGain();
  src.buffer=buffer;
  g.gain.setValueAtTime(0.001,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.4,audioCtx.currentTime+0.3);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+2);
  src.connect(g).connect(audioCtx.destination);
  src.start();
}

/* ================= CANVAS ================= */
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
let tool='pen', drawing=false, world='kucing';
let color='#000';
let animStart=null;
const DURATION=5000;

function setColor(c,el){
  color=c;
  tool='pen';
  document.querySelectorAll('.color-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
}

function drawBase(offset=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.lineWidth=5; ctx.strokeStyle='#000';
  if(world==='kucing'){
    ctx.beginPath(); ctx.arc(400,180-offset,60,0,Math.PI*2); ctx.stroke();
    ctx.beginPath(); ctx.ellipse(400,300-offset,70,90,0,0,Math.PI*2); ctx.stroke();
  }
  if(world==='mobil'){
    ctx.strokeRect(320+offset,260,160,50);
  }
  if(world==='gunung'){
    ctx.beginPath();
    ctx.moveTo(280,350);
    ctx.lineTo(400+offset,150);
    ctx.lineTo(520,350);
    ctx.stroke();
  }
}

function animate(t){
  if(!animStart) animStart=t;
  const p=Math.min((t-animStart)/DURATION,1);
  const move=20*Math.sin(p*Math.PI*2);
  drawBase(Math.abs(move));
  if(p<1) requestAnimationFrame(animate);
  else{ animStart=null; drawBase(); }
}

/* ================= DOODLE ================= */
canvas.onpointerdown=e=>{
  drawing=true;
  ctx.beginPath();
  ctx.moveTo(e.offsetX,e.offsetY);
};
canvas.onpointermove=e=>{
  if(!drawing) return;
  ctx.strokeStyle = tool==='erase' ? '#fffaf3' : color;
  ctx.lineWidth = tool==='erase' ? 24 : 6;
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
};
canvas.onpointerup=()=>drawing=false;

/* ================= PLAY ================= */
function play(){
  clearVoice();
  if(world==='kucing') meong();
  if(world==='mobil') brum();
  if(world==='gunung') angin();
  speak('Wah, gambarnya hidup.');
  animStart=null;
  requestAnimationFrame(animate);
}

/* ================= WORLD ================= */
function switchWorld(w){
  world=w;
  drawBase();
  clearVoice();
  speak(`Ini adalah gambar ${w}.`);
  speak(`Silakan gambar dan warnai ${w}.`);
  speak('Jika sudah selesai, tekan tombol play.');
}

/* ================= START ================= */
function startGame(){
  document.getElementById('menu').style.display='none';
  document.getElementById('worldbar').style.display='flex';
  document.getElementById('toolbar').style.display='flex';
  canvas.style.display='block';
  drawBase();
  clearVoice();
  speak('Selamat datang.');
  speak('Ini adalah gambar kucing.');
  speak('Silakan gambar dan warnai kucing.');
  speak('Jika sudah selesai, tekan tombol play.');
}
</script>
</body>
</html>
